# Схема базы данных системы управления доступом к ресурсам

## Описание системы

Данная система реализует гибкую модель управления доступом на основе ролей  с дополнительными возможностями для управления ресурсами и действиями.

## Основные принципы

1. **Пользователи** имеют **роли**
2. **Роли** имеют **разрешения** на выполнение **действий** с **ресурсами**
3. **Разрешение** = Роль + Ресурс + Действие

## Структура таблиц

### 1. CustomUser (Пользователи)

Расширенная модель пользователя Django с дополнительными полями.

| Поле         | Тип            | Описание                       |
| ------------ | -------------- | ------------------------------ |
| id           | AutoField      | Первичный ключ                 |
| username     | CharField(150) | Уникальное имя пользователя    |
| email        | EmailField     | Email (используется для входа) |
| first_name   | CharField(150) | Имя                            |
| last_name    | CharField(150) | Фамилия                        |
| middle_name  | CharField(150) | Отчество (необязательное)      |
| is_active    | BooleanField   | Активен ли пользователь        |
| is_staff     | BooleanField   | Является ли администратором    |
| is_superuser | BooleanField   | Является ли суперпользователем |
| created_at   | DateTimeField  | Дата создания                  |
| updated_at   | DateTimeField  | Дата обновления                |

### 2. Resource (Ресурсы)

Модель для описания ресурсов в системе.

| Поле        | Тип            | Описание         |
| ----------- | -------------- | ---------------- |
| id          | AutoField      | Первичный ключ   |
| name        | CharField(200) | Название ресурса |
| description | TextField      | Описание ресурса |
| created_at  | DateTimeField  | Дата создания    |
| updated_at  | DateTimeField  | Дата обновления  |

**Примеры ресурсов:**

- posts (посты)
- users (пользователи)
- comments (комментарии)
- files (файлы)

### 3. Action (Действия)

Модель для описания действий, которые можно выполнить с ресурсами.

| Поле        | Тип            | Описание          |
| ----------- | -------------- | ----------------- |
| id          | AutoField      | Первичный ключ    |
| name        | CharField(100) | Название действия |
| description | TextField      | Описание действия |

**Примеры действий:**

- read (чтение)
- create (создание)
- update (обновление)
- delete (удаление)
- approve (одобрение)
- reject (отклонение)

### 4. Role (Роли)

Модель для описания ролей пользователей.

| Поле        | Тип            | Описание                   |
| ----------- | -------------- | -------------------------- |
| id          | AutoField      | Первичный ключ             |
| name        | CharField(100) | Название роли (уникальное) |
| description | TextField      | Описание роли              |
| created_at  | DateTimeField  | Дата создания              |

**Примеры ролей:**

- admin (администратор)
- moderator (модератор)
- author (автор)
- reader (читатель)

### 5. Permission (Разрешения)

Связующая таблица между ролями, ресурсами и действиями.

| Поле       | Тип                  | Описание           |
| ---------- | -------------------- | ------------------ |
| id         | AutoField            | Первичный ключ     |
| role       | ForeignKey(Role)     | Ссылка на роль     |
| resource   | ForeignKey(Resource) | Ссылка на ресурс   |
| action     | ForeignKey(Action)   | Ссылка на действие |
| created_at | DateTimeField        | Дата создания      |

**Уникальность:** Комбинация (role, resource, action) должна быть уникальной.

### 6. UserRole (Роли пользователей)

Связующая таблица между пользователями и ролями.

| Поле        | Тип                    | Описание               |
| ----------- | ---------------------- | ---------------------- |
| id          | AutoField              | Первичный ключ         |
| user        | ForeignKey(CustomUser) | Ссылка на пользователя |
| role        | ForeignKey(Role)       | Ссылка на роль         |
| assigned_at | DateTimeField          | Дата назначения роли   |
| assigned_by | ForeignKey(CustomUser) | Кто назначил роль      |

**Уникальность:** Комбинация (user, role) должна быть уникальной.

### 7. Post (Посты)

Пример ресурса в системе.

| Поле     | Тип                    | Описание        |
| -------- | ---------------------- | --------------- |
| id       | AutoField              | Первичный ключ  |
| text     | TextField              | Текст поста     |
| pub_date | DateTimeField          | Дата публикации |
| author   | ForeignKey(CustomUser) | Автор поста     |


### Примеры разрешений

| Роль   | Ресурс | Действие | Описание                            |
| ------ | ------ | -------- | ----------------------------------- |
| admin  | posts  | read     | Администратор может читать посты    |
| admin  | posts  | create   | Администратор может создавать посты |
| admin  | posts  | update   | Администратор может обновлять посты |
| admin  | posts  | delete   | Администратор может удалять посты   |
| author | posts  | read     | Автор может читать посты            |
| author | posts  | create   | Автор может создавать посты         |
| author | posts  | update   | Автор может обновлять свои посты    |
| reader | posts  | read     | Читатель может только читать посты  |


## Обработка ошибок

- **401 Unauthorized:** Пользователь не аутентифицирован или неактивен
- **403 Forbidden:** Пользователь аутентифицирован, но не имеет необходимых разрешений
